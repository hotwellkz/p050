# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TELEGRAM_SESSION_SECRET –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ "Failed to decrypt telegram session"

## –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ "Failed to decrypt telegram session" –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞:
1. `TELEGRAM_SESSION_SECRET` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ Cloud Run
2. `TELEGRAM_SESSION_SECRET` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ–∫—Ä–µ—Ç (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–µ–Ω)

–ï—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ —Å–µ–∫—Ä–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–π:

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
gcloud run services update shortsai-backend --region us-central1 `
  --update-env-vars "TELEGRAM_SESSION_SECRET=your-existing-64-char-hex-secret"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram)

–ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π —Å–µ–∫—Ä–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π:

```powershell
# 1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç (64 hex —Å–∏–º–≤–æ–ª–∞)
$newSecret = node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ Cloud Run
gcloud run services update shortsai-backend --region us-central1 `
  --update-env-vars "TELEGRAM_SESSION_SECRET=$newSecret"

# 3. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–Ω–æ–≤–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Telegram
# (–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí Telegram ‚Üí –û—Ç–∫–ª—é—á–∏—Ç—å ‚Üí –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∑–∞–Ω–æ–≤–æ)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Secret Manager (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```powershell
# 1. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç
$secret = "your-64-char-hex-secret"
echo -n $secret | gcloud secrets create telegram-session-secret --data-file=-

# 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ä—Å–∏—é (–µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
echo -n $secret | gcloud secrets versions add telegram-session-secret --data-file=-

# 3. –î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø Cloud Run
gcloud secrets add-iam-policy-binding telegram-session-secret `
  --member="serviceAccount:905027425668-compute@developer.gserviceaccount.com" `
  --role="roles/secretmanager.secretAccessor"

# 4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫ Cloud Run (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é, –Ω–µ latest)
gcloud run services update shortsai-backend --region us-central1 `
  --update-secrets TELEGRAM_SESSION_SECRET=telegram-session-secret:1
```

## ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ï—Å–ª–∏ –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç:**
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–Ω–æ–≤–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Telegram —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ–∫—Ä–µ—Ç:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (64 hex —Å–∏–º–≤–æ–ª–∞, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç –Ω–µ –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω —Å –º–æ–º–µ–Ω—Ç–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ–∫—Ä–µ—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint
$url = "https://shortsai-backend-905027425668.us-central1.run.app"
Invoke-RestMethod -Uri "$url/health/auth" -Method Get

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ Syntx
# –û—à–∏–±–∫–∞ "Failed to decrypt telegram session" –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
```

## –ì–¥–µ –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ–∫—Ä–µ—Ç?

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π `.env` —Ñ–∞–π–ª:**
   ```powershell
   Get-Content backend\.env | Select-String "TELEGRAM_SESSION_SECRET"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ä—ã–µ –¥–µ–ø–ª–æ–∏ –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

3. **–ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (–Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç)

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ –°–µ–∫—Ä–µ—Ç `telegram-session-secret` —Å–æ–∑–¥–∞–Ω –≤ Secret Manager (–≤–µ—Ä—Å–∏—è 1)
- ‚ö†Ô∏è –°–µ–∫—Ä–µ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Cloud Run (–∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –¥–µ–ø–ª–æ–µ–º)
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Å—Å–∏–π




